{% block toolbar %}
    {% set icon %}
    <a href="{{ url("webprofiler.dashboard", {profile: token}, {fragment: 'database'}) }}" title="{{ 'Database'|t }}">
        <img width="20" height="28" alt="{{ 'Database'|t }}"
             src="data:image/png;base64,{{ collector.icon }}"/>
        <span class="sf-toolbar-info-piece-additional sf-toolbar-status sf-toolbar-status-{{ collector.colorCode }}">{{ collector.querycount }}</span>
        {% if collector.querycount > 0 %}
            <span class="sf-toolbar-info-piece-additional-detail">in {{ '%0.2f ms'|format(collector.time * 1000) }}</span>
        {% endif %}
    </a>
    {% endset %}
    {% set text %}
    <div class="sf-toolbar-info-piece">
        <b>{{ 'DB Queries'|t }}</b>
        <span>{{ collector.querycount }}</span>
    </div>
    <div class="sf-toolbar-info-piece">
        <b>{{ 'Query time'|t }}</b>
        <span>{{ '%0.2f ms'|format(collector.time * 1000) }}</span>
    </div>
    <div class="sf-toolbar-info-piece">
        <b>{{ 'Default database'|t }}</b>
        <span>{{ collector.database.driver }}://{{ collector.database.host }}:{{ collector.database.port }}
            /{{ collector.database.database }}</span>
    </div>
    {% endset %}

    <div class="sf-toolbar-block">
        <div class="sf-toolbar-icon">{{ icon|default('') }}</div>
        <div class="sf-toolbar-info">{{ text|default('') }}</div>
    </div>
{% endblock %}

{% block panel %}
    <script id="database" type="text/template">
        <h2 class="panel__title">{{ 'Database'|t }}</h2>

        <form class="panel__toolbar">
            <div class="panel__filter--text">
                <input id="edit-caller" class="js--live-filter" placeholder="{{ 'Caller'|t }}" type="text"/>
                <label for="edit-caller" class="panel__filter-label">{{ 'Caller'|t }}</label>
            </div>
            <div class="panel__filter--select">
                <select id="edit-type" class="js--live-filter">
                    <option value="">{{ 'Any'|t }}</option>
                    <option value="select">{{ 'Select'|t }}</option>
                    <option value="insert">{{ 'Insert'|t }}</option>
                    <option value="update">{{ 'Update'|t }}</option>
                    <option value="create">{{ 'Create'|t }}</option>
                    <option value="delete">{{ 'Delete'|t }}</option>
                </select>
                <label for="edit-type" class="panel__filter-label">{{ 'Query type'|t }}</label>
            </div>
        </form>

        <% _.each( data.queries, function( item, key ){ %>
        <div class="panel__container"
             data-wp-caller="<%- item.caller.class %>"
             data-wp-type="<%- item.type %>">
            <div class="panel__expand-header ">
                <pre>
                    <code class="sql">
                        <%- item.query %>
                    </code>
                </pre>
                <ul class="list--inline">
                    <li><b>{{ 'Time'|t }}</b>: <%- item.time * 1000 %></li>
                    <li><b>{{ 'Caller'|t }}</b>: <%= Drupal.webprofiler.helpers.classLink({"file" : item.caller.file,
                        "class" : item.caller.class, "line" : item.caller.line, "method" : item.caller.function}) %>
                    </li>
                    <li><b>{{ 'Target'|t }}</b>: <%- item.target %></li>
                </ul>
                <div class="button--flat l-right js--panel-toggle">{{ 'Info'|t }}</div>
            </div>
            <div class="panel__expand-content">
                <div class="wp-query-arguments">
                    <table class="table--duo">
                        <% _.each( item.args, function( item, key ){ %>
                        <tr>
                            <td><%- key %></td>
                            <td><%- item %></td>
                        </tr>
                        <% }); %>
                    </table>
                </div>

            </div>

        </div>
        <% }); %>
    </script>

    <script id="wp-query-explain-template" type="text/template">
        <h3>{{ 'Explain'|t }}</h3>
        <table>
            <thead>
            <tr>
                <% _.each(wp.data[1], function(value, key, list) { %>
                <th><%= key %></th>
                <% }); %>
            </tr>
            </thead>
            <% _.each(wp.data, function(value) { %>
            <tr>
                <% _.each(value, function(value2, key, list) { %>
                <td><%= value2 %></td>
                <% }); %>
            </tr>
            <% }); %>
        </table>
    </script>
{% endblock %}
