{% block toolbar %}
    {% set icon %}
    <a href="{{ url("webprofiler.dashboard", {profile: token}, {fragment: 'services'}) }}" title="{{ 'Services'|t }}">
        <img width="20" height="28" alt="{{ 'Services'|t }}"
             src="data:image/png;base64,{{ collector.icon }}"/>
        <span class="sf-toolbar-info-piece-additional sf-toolbar-status">{{ collector.countInitializedServices }}</span>
    </a>
    {% endset %}
    {% set text %}
    <div class="sf-toolbar-info-piece">
        <b>{{ 'Initialized'|t }}</b>
        <span>{{ collector.countInitializedServices }} ({{ collector.countInitializedServicesWithoutWebprofiler }}
            )</span>
    </div>
    <div class="sf-toolbar-info-piece">
        <b>{{ 'Available'|t }}</b>
        <span>{{ collector.countServices }}</span>
    </div>
    {% endset %}

    <div class="sf-toolbar-block">
        <div class="sf-toolbar-icon">{{ icon|default('') }}</div>
        <div class="sf-toolbar-info">{{ text|default('') }}</div>
    </div>
{% endblock %}

{% block panel %}
    <script id="services" type="text/template">
        <h2 class="panel__title">{{ 'Services'|t }}</h2>

        <form class="panel__toolbar">
            <div class="panel__filter--text">
                <input id="edit-sid" class="js--live-filter" placeholder="{{ 'ID'|t }}" type="text"/>
                <label for="edit-sid" class="panel__filter-label">{{ 'ID'|t }}</label>
            </div>
            <div class="panel__filter--text">
                <input id="edit-class" class="js--live-filter" placeholder="{{ 'Class'|t }}" type="text"/>
                <label for="edit-class" class="panel__filter-label">{{ 'Class'|t }}</label>
            </div>
            <div class="panel__filter--text">
                <input id="edit-tags" class="js--live-filter" placeholder="{{ 'Tags'|t }}" type="text"/>
                <label for="edit-tags" class="panel__filter-label">{{ 'Tags'|t }}</label>
            </div>
            <div class="panel__filter--select">
                <select id="edit-initialized" class="js--live-filter">
                    <option value="">{{ 'Any'|t }}</option>
                    <option value="1">{{ 'Yes'|t }}</option>
                    <option value="0">{{ 'No'|t }}</option>
                </select>
                <label for="edit-initialized" class="panel__filter-label">{{ 'Initialized'|t }}</label>
            </div>
        </form>

        <% _.each( data.services, function( item, key ){ %>

        <% clazz = Drupal.webprofiler.helpers.classLink({"file" : item.value.file, "class" : item.value.class}) %>
        <% depends = _.map(item.outEdges, function(el) { return el.id; }).join(', ') %>
        <% tags = _.map(item.value.tags, function(el, key) { return key; }).join(', ') %>

        <div class="panel__container"
             data-wp-sid="<%- key %>"
             data-wp-class="<%- item.value.class %>"
             data-wp-tags="<%- tags %>"
             data-wp-initialized="<%- (item.initialized) ? '1' : '0' %>">

            <div class="panel__expand-header">
                <ul class="list--inline">
                    <li>
                        <b>{{ 'ID'|t }}</b>: <%- key %>
                    </li>
                    <li>
                        <b>{{ 'Class'|t }}</b>: <%= clazz %>
                    </li>
                </ul>
                <div class="button--flat l-right js--panel-toggle">{{ 'Info'|t }}</div>
            </div>

            <div class="panel__expand-content">
                <div class="wp-query-arguments">
                    <table class="table--duo">
                        <tr>
                            <td>{{ 'Initialized'|t }}</td>
                            <td><%- (item.initialized) ? '{{ 'Yes'|t }}' : '{{ 'No'|t }}' %></td>
                        </tr>
                        <tr>
                            <td>{{ 'Tags'|t }}</td>
                            <td><%- tags %></td>
                        </tr>
                        <tr>
                            <td>{{ 'Depends'|t }}</td>
                            <td><%- depends %></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <% }); %>

        <div class="panel__container">
            <ul>
                <% _.each( data.http_middleware, function( item, key ){ %>
                <li><%- key %> (priority: <%- item.value.tags.http_middleware[0].priority %>)</li>
                <% }); %>
            </ul>
        </div>

        <% console.log(data) %>

    </script>
{% endblock %}
