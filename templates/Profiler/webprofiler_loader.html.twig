<div id="webprofiler{{ token }}" class="sf-toolbar" style="display: none"></div>

<script>
    Sfjs = (function () {
        "use strict";

        var profilerStorageKey = 'webprofiler/profiler/',

                getPreference = function (name) {
                    if (!window.localStorage) {
                        return null;
                    }

                    return localStorage.getItem(profilerStorageKey + name);
                },

                setPreference = function (name, value) {
                    if (!window.localStorage) {
                        return null;
                    }

                    localStorage.setItem(profilerStorageKey + name, value);
                    return true;
                };

        return {
            getPreference: getPreference,
            setPreference: setPreference
        }
    })();

    Loader = (function () {
        "use strict";

        loadXMLDoc('/profiler/{{ token }}', function (result) {
            document.getElementById('webprofiler{{ token }}').innerHTML = result;
            document.getElementById('webprofiler{{ token }}').style.display = 'block';

            if (Sfjs.getPreference('toolbar/displayState') == 'none') {
                document.getElementById('sfToolbarMainContent-{{ token }}').style.display = 'none';
                document.getElementById('sfToolbarClearer-{{ token }}').style.display = 'none';
                document.getElementById('sfMiniToolbar-{{ token }}').style.display = 'block';
            } else {
                document.getElementById('sfToolbarMainContent-{{ token }}').style.display = 'block';
                document.getElementById('sfToolbarClearer-{{ token }}').style.display = 'block';
                document.getElementById('sfMiniToolbar-{{ token }}').style.display = 'none';
            }
        });

        function loadXMLDoc(url, callback) {
            var xmlhttp = new XMLHttpRequest();

            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    callback(xmlhttp.responseText);
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }
    })();

    new Loader();
</script>
